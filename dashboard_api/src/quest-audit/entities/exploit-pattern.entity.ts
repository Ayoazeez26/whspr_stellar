import { Entity, PrimaryGeneratedColumn, Column, CreateDateColumn, UpdateDateColumn, Index } from "typeorm"

@Entity("exploit_patterns")
export class ExploitPattern {
  @PrimaryGeneratedColumn("uuid")
  id: string

  @Column({ type: "varchar", length: 255 })
  @Index()
  patternName: string

  @Column({ type: "text" })
  description: string

  @Column({ type: "varchar", length: 50 })
  severity: string // 'low', 'medium', 'high', 'critical'

  @Column({ type: "jsonb" })
  detectionRules: {
    timeWindow?: number // seconds
    maxCompletions?: number
    minTimeBetween?: number // seconds
    ipDuplication?: boolean
    suspiciousMetadata?: string[]
  }

  @Column({ type: "boolean", default: true })
  @Index()
  isActive: boolean

  @Column({ type: "int", default: 0 })
  detectionCount: number

  @Column({ type: "timestamp", nullable: true })
  lastDetectedAt: Date

  @CreateDateColumn()
  createdAt: Date

  @UpdateDateColumn()
  updatedAt: Date
}
